<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>pixiTest</title>

    <script src="https://rawgithub.com/mrdoob/stats.js/master/build/stats.min.js"></script>

    <!--<script src="assets/js/pixi/pixi.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.0.0-rc3/pixi.js"></script>
    <script src="assets/js/pixi/filters.min.js"></script>
    <script src="assets/js/gsap/TweenLite.min.js"></script>


    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #screen {
            position: absolute;
        }
    </style>
</head>

<body>
<div id="screen"></div>

<script>
    /*--------------------------------------------
     ~ DEV-STUFF
     --------------------------------------------*/
    var debugMode = true;
    var stats = new Stats();
    stats.setMode(0); // 0: fps, 1: ms

    // Align top-left
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.left = '0px';
    stats.domElement.style.top = '0px';

    document.body.appendChild(stats.domElement);

    if (!debugMode) {
        console = {
            log: function () {
            }
        };
    }

    /*--------------------------------------------
     ~ LOADER
     --------------------------------------------*/
    PIXI.loader.add('img_1', 'assets/img/fsImage_1200x750_c.jpg');
    PIXI.loader.add('img_2', 'assets/img/fsImage_1920x1372.jpg');
    // listen for progress
    PIXI.loader.on('progress', onProgressCallback);
    function onProgressCallback(e) {
        console.log(e.progress);
    }
    // load resources
    PIXI.loader.load(function (loader, resources) {
        // resources is an object containing the loaded resources, keyed by the names you used above.
        var sprite = new PIXI.Sprite(resources.img_1.texture);
        console.log(resources.img_1.texture)
    });

    /*--------------------------------------------
     ~ SETUP
     --------------------------------------------*/
    var $imageWidth = 1200;
    var $imageHeight = 750;

    var _screen = document.getElementById('screen');
    var screenWidth = function () {
        return window.innerWidth
    };
    var screenHeight = function () {
        return window.innerHeight
    };

    var rendererOptions = {
        antialiasing: false,
        transparent: false,
        backgroundColor: 0x0a5a15,
        autoResize: false
    };

    var pixiRenderer = new PIXI.autoDetectRenderer(screenWidth(), screenHeight(), rendererOptions);
    _screen.appendChild(pixiRenderer.view);
    console.log(pixiRenderer)

    // create the root of the scene graph
    var stage = new PIXI.Container();
    var fsImage_tex = PIXI.Texture.fromImage('assets/img/fsImage_1200x750_c.jpg');
    var fsImage = new PIXI.Sprite(fsImage_tex);
    fsImage.anchor.x = 0.5;
    fsImage.anchor.y = 0.6;
    fsImage.anchor.x = 0.0;
    fsImage.anchor.y = 0.0;
    fsImage.x = 0;
    fsImage.y = 0;
    stage.addChild(fsImage);

    //  FILTER TEST!
    //    var filter = new PIXI.filters.AsciiFilter();
    //    var filter = new PIXI.filters.BloomFilter()
    // colorMatrix
    //    var filter = new PIXI.filters.ColorMatrixFilter()
    //    filter.saturate(-.5);
    //    fsImage.filters = [filter];


    var fsImageRatio;
    TweenLite.delayedCall(.5, check);
    function check() {
        fsImageRatio = fsImage.texture.width / fsImage.texture.height;
//        console.log(fsImageRatio);
        onResize();
    }

    animate();
    function animate() {
        requestAnimationFrame(animate);

        // render the container
        pixiRenderer.render(stage);

        stats.update();
    }

    window.addEventListener('resize', onResize);

    function onResize(e) {

        var $screenWidth = screenWidth();
        var $screenHeight = screenHeight();

        //this part resizes the canvas but keeps ratio the same
        pixiRenderer.view.style.width = $screenWidth + "px";
        pixiRenderer.view.style.height = $screenHeight + "px";
        // this part adjusts the ratio:
        pixiRenderer.resize($screenWidth, $screenHeight);

        var r = $screenWidth / $imageWidth;
//        console.log(r);

        fsImage.scale = new PIXI.Point(r, r);
//        fsImage.x = fsImage.width * .5;
//        fsImage.y = fsImage.height * .6;

        if (fsImage.height > $screenHeight) {
            r = $screenWidth / $imageWidth;
            fsImage.scale = new PIXI.Point(r, r);
            fsImage.x = 0;
            fsImage.y = -(fsImage.height - $screenHeight) * .5;
            console.log(fsImage.y)
        } else if (fsImage.height < $screenHeight) {
            r = $screenHeight / $imageHeight;
            console.log(r)
            fsImage.y = 0;
            fsImage.scale = new PIXI.Point(r, r);
            fsImage.x = ($screenWidth - fsImage.width) * .5;
        }

        console.log(fsImage.height);
    }


</script>

</body>
</html>