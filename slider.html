<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ABRAHADABRA</title>

    <script src="assets/js/gsap/TweenMax.min.js"></script>
    <script src="assets/js/gsap/utils/Draggable.min.js"></script>
    <script src="assets/js/gsap/plugins/ThrowPropsPlugin.min.js"></script>
    <script src="assets/js/gsap/plugins/DrawSVGPlugin.min.js"></script>

    <style>
        body {
            background-color: #2d2d2d;
            overflow: hidden;
            /* font-family: 'Fjalla One', sans-serif; */
            font-family: 'Passion One', sans-serif;

        }

        body,
        html {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            text-align: center
        }

        .dot {
            cursor: pointer;
        }

        .hitArea, .dragContainer {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        #bimbo {
            width: 100px;
            height: 100px;
            position: absolute;
            background-color: aqua;
        }

        .dot {
            width: 100px;
            height: 100px;
            position: absolute;
            background-color: #d9181b;
        }
    </style>


</head>


<body>


<div id="bimbo"></div>

<div class="dot"></div>
<div class="dotGroup">
    <div class="dotContainer" filter="url(#goo)">
    </div>

    <div class="iconContainer"></div>
    <div class="bubbleContainer"></div>
</div>


<script>
    console.clear();
    var xmlns = "http://www.w3.org/2000/svg",
            xlinkns = "http://www.w3.org/1999/xlink",
            select = function (s) {
                return document.querySelector(s);
            },
            selectAll = function (s) {
                return document.querySelectorAll(s);
            },
    //container = select('.container'),
            dotContainer = select('.dotContainer'),
            iconContainer = select('.iconContainer'),
            bubbleContainer = select('.bubbleContainer'),
            hitArea = select('.hitArea'),
            dotGroup = select('.dotGroup'),
            spacer = 100,
            minDragX,
            numItems = 20,
            dotSize = .1,
    //step, = spacer + (dotSize / 2),
            snapArray = [],
            multiplier = 4.8,
            iconArray = ['bimbo', 'bimbo', 'bimbo', 'bimbo', 'bimbo'],
            numItems = iconArray.length,
            currentIconId,
            oldIconId = -1,
            currentSpeechBubble,
            dragger


    var mainTl = new TimelineMax({
        paused: true
    });

    function makeMenu() {
        var tl;
        for (var i = 0; i < numItems; i++) {
            var c = select('.dot').cloneNode(true);
            var ic = select('#' + iconArray[i]).cloneNode(true);
            dotContainer.appendChild(c);
            iconContainer.appendChild(ic);
            TweenMax.set(c, {
                left: (i * spacer),
                scale: dotSize
            })
            TweenMax.set(ic, {
                x: (i * spacer + 30),
                y: 30,
                width: 10,
                height: 10,
                transformOrigin: '50% 50%',
                scale: 0,
                alpha: 0,
            })


            snapArray.push((-i * (spacer)));

            tl = new TimelineMax({});

            tl.to(c, 1, {
                scale: dotSize * multiplier,
                ease: Linear.easeNone
            })
                    .to(ic, 1, {
                        alpha: 1,
                        scale: 2,
                        ease: Linear.easeNone

                    }, '-=1')
                    .to(c, 1, {
                        scale: dotSize,
                        ease: Linear.easeNone
                    })
                    .to(ic, 1, {
                        alpha: 0,
                        scale: 0,
                        ease: Linear.easeNone
                    }, '-=1')

            mainTl.add(tl, (i / 2));

        }

        minDragX = (-(numItems - 1) * spacer);


        dragger = Draggable.create(dotContainer, {
            type: 'x',
            bounds: {
                minX: minDragX,
                maxX: 0
            },
            onDrag: dragSlider,
            onDragStart: dragStart,
            onThrowUpdate: dragSlider,
            throwProps: true,
            onThrowComplete: throwComplete,
            minDuration: 1,
            snap: snapArray
        })

        dragger[0].disable();


        TweenMax.set(dotGroup, {
            x: 400
        })


        TweenMax.to([dotContainer, iconContainer], 2, {
            x: (snapArray[Math.floor(numItems / 2)]),
            onUpdate: dragSlider,
            onComplete: function () {
                throwComplete();
                dragger[0].enable();

            },
            ease: Elastic.easeOut.config(1, 0.85)
        })

    } //end function


    function dragSlider() {
        var posX = dotContainer._gsTransform.x;
//        console.log(posX)
        TweenMax.to(mainTl, 0.5, {
            //time:((posX/minDragX) * (mainTl.duration()-2))+1,
            time: ((posX / minDragX) * (mainTl.duration() - 2)) + 1,
            ease: Elastic.easeOut.config(2, 0.75)
        })
        //mainTl.time(((posX/minDragX) * (mainTl.duration()-2))+1)
        TweenMax.set(iconContainer, {
            x: posX
        })
        TweenMax.to(bubbleContainer, 1, {
            x: posX,
            ease: Elastic.easeOut.config(1, 0.5)
        })
    }

    function throwComplete() {

        var landed = Math.ceil(dotContainer._gsTransform.x / spacer);
        currentIconId = Math.abs(landed);
        console.log(currentIconId)

    }


    function dragStart() {

    }

    document.body.onclick = function (e) {
        //console.log(e.target.className.baseVal)
        if (e.target.className.baseVal !== 'dot') {
            return;
        }

        //console.log(e.target.getAttribute('btnId'));
        oldIconId = currentIconId;
        currentIconId = parseInt(e.target.getAttribute('btnId'));

        if (oldIconId == currentIconId) {

            return
        }
        TweenMax.to([dotContainer, iconContainer], 0.8, {
            x: (snapArray[currentIconId]),
            onUpdate: dragSlider,
            onComplete: throwComplete,
            ease: Power1.easeOut
            //ease:Back.easeOut
        })


    }

    makeMenu();

</script>

</body>
</html>